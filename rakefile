require 'fileutils'
require 'rake/clean'

require_relative 'rake/environment'
require_relative 'rake/libs'
require_relative 'rake/common'
require_relative 'rake/tools'
require_relative 'rake/ndbl'

task :default => :help

desc "says hello"
task :help do
    print("Welcome to Nodable's rakefile.\nFor more info, run: rake --tasks\n")
end

desc "Install dependencies"
task :install => [] do
    if BUILD_OS_LINUX
        system "sudo apt-get update && sudo apt-get install libegl1-mesa-dev libdbus-1-dev libgtk-3-dev" or raise "Unable to install packages"
    elsif BUILD_OS_MACOS
        system "brew install mesalib-glw" or raise "Unable to install packages"
    else BUILD_OS_WINDOWS
        puts "nothing to install for your system"
    end
end

task :build => ['tools:build', 'ndbl:build'] do puts "Build DONE" end
task :pack  => ['tools:pack' , 'ndbl:pack'] do puts "Pack DONE" end
task :run   => ['tools:run'  , 'ndbl:run']


# TODO: use the officials tools to clean properly
task :clean do
    puts "Cleaning install dir ..."
    if File.exists?(INSTALL_DIR)
        FileUtils.remove_entry_secure INSTALL_DIR
    end
    puts "Cleaning build dir ..."
    if File.exists?(BUILD_DIR)
        FileUtils.remove_entry_secure BUILD_DIR
    end
    puts "Clean DONE"
end